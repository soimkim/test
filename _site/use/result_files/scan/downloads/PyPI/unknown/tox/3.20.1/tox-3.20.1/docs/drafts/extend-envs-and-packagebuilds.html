<!DOCTYPE html> <html lang="en" dir="auto"> <head><meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=no"> <meta name="description" content="Extension of environment handling and building packages Issue reference: #338 Notes from a discussion at the pytest sprint 2016 Goal: drive buildin..."> <meta name="revised" content="a1c138ed45080c1a27f71bead0d71b31dd27e84e"> <meta name="author" content="soimkim"> <meta name="generator" content="rundocs/jekyll-rtd-theme v2.0.10"><meta name="theme-color" content="#2980b9"> <title>Extension of environment handling and building packages · OSS Review Toolkit</title> <meta name="twitter:title" content="Extension of environment handling and building packages · OSS Review Toolkit"> <meta name="twitter:description" content="Extension of environment handling and building packages Issue reference: #338 Notes from a discussion at the pytest sprint 2016 Goal: drive buildin..."> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@soimkim"> <meta name="twitter:url" content="http://localhost:4000/use/result_files/scan/downloads/PyPI/unknown/tox/3.20.1/tox-3.20.1/docs/drafts/extend-envs-and-packagebuilds.html"> <meta name="twitter:creator" content="@rundocs/jekyll-rtd-theme v2.0.10"> <meta property="og:title" content="Extension of environment handling and building packages · OSS Review Toolkit"> <meta property="og:description" content="Extension of environment handling and building packages Issue reference: #338 Notes from a discussion at the pytest sprint 2016 Goal: drive buildin..."> <meta property="og:locale" content="en"> <meta property="og:url" content="http://localhost:4000/use/result_files/scan/downloads/PyPI/unknown/tox/3.20.1/tox-3.20.1/docs/drafts/extend-envs-and-packagebuilds.html"> <meta property="og:type" content="article"> <meta property="article:author" content="soimkim"> <meta property="article:published_time" content="2021-04-16T11:55:49+09:00"> <meta property="article:modified_time" content="2021-04-16T11:55:49+09:00"> <script type="application/ld+json"> { "@context": "https://schema.org", "@type": "Article", "mainEntityOfPage": { "@type": "WebPage", "@id": "http://localhost:4000/use/result_files/scan/downloads/PyPI/unknown/tox/3.20.1/tox-3.20.1/docs/drafts/extend-envs-and-packagebuilds.html" }, "headline": "Extension of environment handling and building packages · OSS Review Toolkit", "image": [], "author": { "@type": "Person", "name": "soimkim" }, "datePublished": "2021-04-16T11:55:49+09:00", "dateModified": "2021-04-16T11:55:49+09:00", "publisher": { "@type": "", "name": "soimkim", "logo": { "@type": "ImageObject", "url": "" } }, "description": "Extension of environment handling and building packages Issue reference: #338 Notes from a discussion at the pytest sprint 2016 Goal: drive buildin..." } </script> <link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="next" href="http://localhost:4000/use/result_files/scan/downloads/PyPI/unknown/tox/3.20.1/tox-3.20.1/docs/drafts/tox_conda_notes_niccodemus.html"><link rel="canonical" href="http://localhost:4000/use/result_files/scan/downloads/PyPI/unknown/tox/3.20.1/tox-3.20.1/docs/drafts/extend-envs-and-packagebuilds.html"><link rel="icon" type="image/png" href="/assets/images/favicon.png"><link rel="icon" type="image/png" href="/assets/images/favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="/assets/images/favicon-32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="/assets/images/favicon-96x96.png" sizes="96x96"><link rel="mask-icon" href="/assets/images/favicon.png" color="#2980b9"><link rel="apple-touch-icon" href="/assets/images/apple-touch-icon-300x300.jpg"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@2.0.10/assets/css/theme.min.css"><style>.header { color: #444444; background: #A50034; }.sidebar { color: #A50034; background: #444444; }.toctree { color: #A50034; }input.form-control { border-color: #3E4538; }a.caption { color: #ff0c59 !important; }</style><script> window.ui = { title: "OSS Review Toolkit", baseurl: "", i18n: { search_results: "Search Results", search_results_found: "Search finished, found # page(s) matching the search query.", search_results_not_found: "Your search did not match any documents, please make sure that all characters are spelled correctly!" } }; </script> </head> <body class="container"><div class="sidebar-wrap overflow-hidden"> <div class="sidebar height-full overflow-y-scroll overflow-x-hidden"> <div class="header d-flex flex-column p-3 text-center"> <div class="title pb-1"> <a class="h4 no-underline py-1 px-2 rounded-1" href="/" title="OSS Review Toolkit Korean Guide"> <i class="fa fa-home"></i> OSS Review Toolkit </a> </div> <span class="version"></span> <form class="search pt-2" action="/search.html" method="get" autocomplete="off"> <input class="form-control input-block input-sm" type="text" name="q" placeholder="Search docs..."> </form> </div> <div class="toctree py-2" data-spy="affix" role="navigation" aria-label="main navigation"> <ul> </ul> <a class="caption d-block text-uppercase no-wrap px-2 py-0" href="/run/"> How to Run </a><ul> <li class="toc level-1 " data-sort="1" data-level="1"> <a class="d-flex flex-items-baseline " href="/run/1_analyze.html">1. Source Install</a> </li> <li class="toc level-1 " data-sort="2" data-level="1"> <a class="d-flex flex-items-baseline " href="/run/2_check.html">2. 설치 확인 방법</a> </li></ul> <a class="caption d-block text-uppercase no-wrap px-2 py-0" href="/use/"> How to Use </a><ul> <li class="toc level-1 " data-sort="1" data-level="1"> <a class="d-flex flex-items-baseline " href="/use/1_analyze.html">1. 세부 실행 방법</a> </li> <li class="toc level-1 " data-sort="2" data-level="1"> <a class="d-flex flex-items-baseline " href="/use/2_result.html">2. 실행 결과</a> </li></ul> </div> </div> </div> <div class="content-wrap"> <div class="header d-flex flex-justify-between p-2 hide-lg hide-xl" aria-label="top navigation"> <button id="toggle" aria-label="Toggle menu" class="btn-octicon p-2 m-0 text-white" type="button"> <i class="fa fa-bars"></i> </button> <div class="title flex-1 d-flex flex-justify-center"> <a class="h4 no-underline py-1 px-2 rounded-1" href="/">OSS Review Toolkit</a> </div> </div> <div class="content p-3 p-sm-5"> <div class="navigation-top d-flex flex-justify-between"> <ul class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation"> <li class="breadcrumb-item"> <a class="no-underline" href="/" title="/"> <i class="fa fa-home"></i> </a> </li><li class="breadcrumb-item" ><a href="/use/">use</a></li><li class="breadcrumb-item" ><a href="/use/result_files/">result_files</a></li><li class="breadcrumb-item" ><a href="/use/result_files/scan/">scan</a></li><li class="breadcrumb-item" ><a href="/use/result_files/scan/downloads/">downloads</a></li><li class="breadcrumb-item" ><a href="/use/result_files/scan/downloads/PyPI/">PyPI</a></li><li class="breadcrumb-item" ><a href="/use/result_files/scan/downloads/PyPI/unknown/">unknown</a></li><li class="breadcrumb-item" ><a href="/use/result_files/scan/downloads/PyPI/unknown/tox/">tox</a></li><li class="breadcrumb-item" ><a href="/use/result_files/scan/downloads/PyPI/unknown/tox/3.20.1/">3.20.1</a></li><li class="breadcrumb-item" ><a href="/use/result_files/scan/downloads/PyPI/unknown/tox/3.20.1/tox-3.20.1/">tox-3.20.1</a></li><li class="breadcrumb-item" ><a href="/use/result_files/scan/downloads/PyPI/unknown/tox/3.20.1/tox-3.20.1/docs/">docs</a></li><li class="breadcrumb-item" ><a href="/use/result_files/scan/downloads/PyPI/unknown/tox/3.20.1/tox-3.20.1/docs/drafts/">drafts</a></li><li class="breadcrumb-item" aria-current="page">extend-envs-and-packagebuilds.md</li></ul> <a class="edit" href="https://github.com/soimkim/test/edit/gh-pages/use/result_files/scan/downloads/PyPI/unknown/tox/3.20.1/tox-3.20.1/docs/drafts/extend-envs-and-packagebuilds.md" title="Edit on GitHub" rel="noreferrer" target="_blank"> <i class="fa fa-edit"></i> </a> </div> <hr> <div role="main" itemscope="itemscope" itemtype="https://schema.org/Article"> <div class="markdown-body" itemprop="articleBody"> <h1 id="extension-of-environment-handling-and-building-packages">Extension of environment handling and building packages</h1> <p>Issue reference: #338</p> <p><em>Notes from a discussion at the pytest sprint 2016</em></p> <p>Goal: drive building of packages and the environments needed to test them, exercising the tests and report the results for more than just virtualenvs and python virtualenvs</p> <h3 id="problems">Problems</h3> <ul> <li>No concept of mapping environments to specific packages (versioned packages)</li> <li>no control over when it happens for specific environment</li> <li>no control over how it happens (e.g. which python interpreter is used to create the package)</li> <li>No way of triggering build only if there is an environment that needs a specific build trigger it only if an environment actually needs it</li> <li>package definition that might match on everything might be a problem for which environments test? Not clear?</li> </ul> <h3 id="solution">Solution</h3> <p>It should be possible to build other kinds of packages than just the standard sdist and it should also be possible to create different kinds of builds that can be used from different environments. To make this possible there has to be some concept of factorized package definitions and a way to match these factorized builds to environments with a similar way of matching like what is in place already to generate environments. sdist would for example would match to a "sdist" factor to only be matched against virtualenvs as the default.</p> <p>This could then be used to have virtualenv, conda, nixos, docker, pyenv, rpm, deb, etc. builds and tie them to concrete test environments.</p> <p>To summarize - we would need a:</p> <div class="language-plaintext highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code>* packagedef (how to build a package)
* envdef (how to build an environment)
* way of matching envs to concrete packages (at package definition level) (e.g `{py27,py34}-{win32,linux}-{venv,conda,pyenv}-[...]`)
</code></pre>  </div></div> <h2 id="beginnings-of-configuration-examples-not-thought-out-yet">Beginnings of configuration examples (not thought out yet)</h2> <div class="language-plaintext highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code>[tox]
envlist={py,27,py34}-{win32, linux}-{conda,virtualenv}

[packagedef:sdist]
# how to build (e.g. {py27,py34}-{sdist})
# how to match (e.g. {py27,py34}-{sdist})

[packagedef:conda]
# how to build (e.g. {py27,py34}-{conda})
# how to match (e.g. {py27,py34}-{conda})

[packagedef:wheel]
# how to build
# how to match
</code></pre>  </div></div> <h4 id="integrate-detox">integrate detox</h4> <ul> <li>reporting in detox is minimal (would need to improve)</li> <li>restricting processes would be necessary depending on power of the machine (creating 16 processe on a dual core machine might be overkill)</li> <li>port it from eventlets to threads?</li> </ul> <h3 id="concrete-use-case-conda-integration-started-by-bruno">Concrete use case conda integration (started by Bruno)</h3> <ul> <li>Asynchronicity / detox not taken into account yet</li> <li>Conda activation might do anything (change filesys, start DBs)</li> <li>Can I activate environments in parallel</li> <li>Packages would need to be created (from conda.yml)</li> <li>Activation is a problem</li> </ul> <h3 id="unsorted-discussion-notes">Unsorted discussion notes</h3> <ul> <li>Simplify for the common case: most packages are universal, so it should be simple one to one relationship from environment to directory</li> <li>Floris: metadata driven. Package has metadata to the env with what env it is compatible</li> <li>Holger: configuration driven. explicitly configuring which packages should be used (default sdist to be used, overridable by concrete env)</li> <li>Ronny: "package definitions" (this package, this setup command) + matching definitions (matching packages (with wildcards) for environments)</li> </ul> <h2 id="proposal">Proposal</h2> <p>This feature shall allow one to specify how plugins can specify new types of package formats and environments to run test commands in.</p> <p>Such plugins would take care of setting up the environment, create packages and run test commands using hooks provided by tox. The actual knowledge how to create a certain package format is implement in the plugin.</p> <p>Plugin decides which is the required python interpreter to use in order to create the relevant package format.</p> <div class="language-ini highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code><span class="nn">[tox]</span>
<span class="py">plugins</span><span class="p">=</span><span class="s">conda # virtualenv plugin is builtin; intention here is to bail out early in case the specified plugins</span>
              <span class="c"># are not installed
</span><span class="py">envlist</span><span class="p">=</span><span class="s">py27,py35</span>

<span class="nn">[testenv]</span>
<span class="py">package_formats</span><span class="p">=</span>            <span class="c"># new option to specify wanted package formats for test environment using tox factors feature
</span>                            <span class="c"># defaults to "sdist" if not set
</span>    <span class="s">py35: sdist wheel conda # names here are provided by plugins (reserved keywords)</span>
    <span class="err">py27:</span> <span class="err">sdist</span> <span class="err">conda</span>
<span class="py">commands</span> <span class="p">=</span> <span class="s">py.test</span>
</code></pre>  </div></div> <p>Lising tox environments (<code class="language-plaintext highlighter-rouge notranslate">tox --list</code>) would display the following output:</p> <div class="language-plaintext highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code>(sdist) py27
(conda) py27
(sdist) py35
(wheel) py35
(conda) py35
</code></pre>  </div></div> <p>To remain backward-compatible, the package format will not be displayed if only a single package format is specified.</p> <p>How to skip building a package for a specific factor?</p> <p>Illustrate how to exclude a certain package format for a factor:</p> <div class="language-ini highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code><span class="nn">[tox]</span>
<span class="py">plugins</span><span class="p">=</span><span class="s">conda</span>
<span class="py">envlist</span><span class="p">=</span><span class="s">py27,py35,py27-xdist</span>

<span class="nn">[testenv]</span>
<span class="py">commands</span> <span class="p">=</span> <span class="s">py.test</span>
<span class="py">package_formats</span><span class="p">=</span><span class="s">sdist wheel conda</span>
<span class="py">exclude_package_formats</span><span class="p">=</span>        <span class="c"># new option which filters out packages
</span>    <span class="s">py27-xdist: wheel</span>
</code></pre>  </div></div> <p>or possibly using the negated factor condition support:</p> <div class="language-ini highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code><span class="nn">[tox]</span>
<span class="py">plugins</span><span class="p">=</span><span class="s">conda</span>
<span class="py">envlist</span><span class="p">=</span><span class="s">py27,py35,py27-xdist</span>

<span class="nn">[testenv]</span>
<span class="py">commands</span> <span class="p">=</span> <span class="s">py.test</span>
<span class="py">package_formats</span><span class="p">=</span>
    <span class="err">sdist</span>
    <span class="err">!py27,!xdist:</span> <span class="err">wheel</span>
    <span class="err">conda</span>
</code></pre>  </div></div> <p>Output of <code class="language-plaintext highlighter-rouge notranslate">tox --list</code>:</p> <div class="language-plaintext highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code>(sdist) py27
(wheel) py27
(conda) py27
(sdist) py35
(wheel) py35
(conda) py35
(sdist) py27-xdist
(conda) py27-xdist
</code></pre>  </div></div> <h3 id="implemenation-details">Implemenation Details</h3> <div class="language-plaintext highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code>tox_package_formats() -&gt; ['conda']   # ['sdist', 'wheel']
tox_testenv_create(env_meta, package_type) -&gt; # creates an environment for given package, using
                                                  # information from env_meta (like .envdir)
                                                  # returns: an "env" object which is forwaded to the next hooks
tox_testenv_install(env_meta, package_type, env) -&gt; # installs deps and package into environment
tox_testenv_runtest(env_meta, package_type, env) -&gt; # activates environment and runs test commands

tox_testenv_updated(env_meta, package_type) -&gt;  # returns True if hte environment is already up to date
                                                # otherwise, tox will remove the environment completely and
                                                # create a new one
</code></pre>  </div></div> </div> </div> <div class="navigation-bottom d-flex flex-justify-between py-3" role="navigation" aria-label="footer navigation"> <div class="prev"></div> <div class="next"><a href="/use/result_files/scan/downloads/PyPI/unknown/tox/3.20.1/tox-3.20.1/docs/drafts/tox_conda_notes_niccodemus.html" class="btn" title="" accesskey="n" rel="next"> Next <i class="fa fa-arrow-circle-right"></i> </a></div> </div><hr> <div class="copyright text-center text-gray" role="contentinfo"> <i class="fa fa-copyright"></i> <span class="time">2021,</span> <a class="text-gray" href="https://github.com/soimkim" rel="noreferrer" target="_blank">soimkim</a> Revision <a class="text-gray" href="https://github.com/soimkim/test/commit/a1c138ed45080c1a27f71bead0d71b31dd27e84e" title="a1c138ed45080c1a27f71bead0d71b31dd27e84e" rel="noreferrer" target="_blank">a1c138e</a> <br> <div class="generator"> Built with <a href="https://pages.github.com" rel="noreferrer" target="_blank" title="github-pages v209">GitHub Pages</a> using a <a href="https://github.com/rundocs/jekyll-rtd-theme" rel="noreferrer" target="_blank" title="rundocs/jekyll-rtd-theme v2.0.10">theme</a> provided by <a href="https://rundocs.io" rel="noreferrer" target="_blank">RunDocs</a>. </div> </div> </div> </div> <div class="addons-wrap d-flex flex-column overflow-y-auto"> <div class="status d-flex flex-justify-between p-2"> <div class="title p-1"> <i class="fa fa-book"></i> OSS Review Toolkit </div> <div class="branch p-1"> <span class="name"> gh-pages </span> <i class="fa fa-caret-down"></i> </div> </div> <div class="addons d-flex flex-column height-full p-2 d-none"> <dl> <dt>GitHub</dt> <dd> <a href="https://github.com/soimkim/test" title="Stars: "> <i class="fa fa-github"></i> Homepage </a> </dd> <dd> <a href="" title="Open issues: "> <i class="fa fa-question-circle-o"></i> Issues </a> </dd> <dd> <a href="https://github.com/soimkim/test/zipball/gh-pages" title="Size: Kb"> <i class="fa fa-download"></i> Download </a> </dd> </dl> <hr> <div class="license f6 pb-2"> This <a href="/" title="OSS Review Toolkit">Software</a> is under the terms of <a href="https://github.com/soimkim/test">The Unlicense</a>. </div> </div> </div> <script src="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@2.0.10/assets/js/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@2.0.10/assets/js/theme.min.js"></script> </body> </html>